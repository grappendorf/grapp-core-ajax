
<!--
Copyright (c) 2014-2015 Dirk Grappendorf, www.grappendorf.net. All rights reserved.
This code may only be used under the MIT style license found in the file LICENSE.txt.

Element: grapp-core-ajax
Version: 0.0.2
Description: A Polymer core-ajax web component with some customizations
-->


<link rel="import" href="../core-ajax/core-ajax.html">

<polymer-element name="grapp-core-ajax" extends="core-ajax" attributes="token">

<script type="text/javascript">(function() {
  Polymer('grapp-core-ajax', {
    processError: function(xhr) {
      var response;
      try {
        response = JSON.parse(xhr.responseText);
      } catch (_error) {
        response = '';
      }
      return this.fire('core-error', {
        status: xhr.status,
        response: response,
        xhr: xhr
      });
    },
    go: function() {
      this.headers = this.headers || {};
      if (this.headers && typeof this.headers === 'string') {
        this.headers = JSON.parse(this.headers);
      }
      if (this.handleAs === 'json') {
        headers['Accept'] = 'application/json';
      }
      if (this.token) {
        headers['Authorization'] = this.token;
      }
      return this["super"]();
    }
  });

}).call(this);
</script>

</polymer-element>
